<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title></title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap-3.0.0-wip.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="brand" href="http://github.com/jsoverson/plato">Plato on Github</a>
    <ul class="nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>utils.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="span6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"></i></a></h2>
      <p class="stat">58.93</p>
    </div>
    <div class="span6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC"></i></h2>
      <p class="stat">166</p>
    </div>
  </div>
  <div class="row historical">
    <div class="span6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="span6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="span6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty"></i></a></h2>
      <p class="stat">44.21</p>
    </div>
    <div class="span6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs"></i></a></h2>
      <p class="stat">1.72</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="span6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="span6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="span12">/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- /
/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */

'use strict';

// Based on Resig's pretty date
var _ = navigator.mozL10n.get;
var dtf = new navigator.mozL10n.DateTimeFormat();

var Utils = {
  updateTimeHeaders: function ut_updateTimeHeaders() {
    var elementsToUpdate =
        document.querySelectorAll('header[data-time-update]');
    if (elementsToUpdate.length > 0) {
      for (var i = 0; i < elementsToUpdate.length; i++) {
        var ts = elementsToUpdate[i].dataset.time;
        var tmpHeaderDate;
        if (elementsToUpdate[i].dataset.isThread) { // only date
          tmpHeaderDate = Utils.getHeaderDate(ts);
        } else {
          elementsToUpdate[i].dataset.hourOnly ?
            tmpHeaderDate = Utils.getFormattedHour(ts) : // only time
            tmpHeaderDate = Utils.getHeaderDate(ts) + ' ' +
                            Utils.getFormattedHour(ts); // date + time
        }
        var currentHeader = elementsToUpdate[i].innerHTML;
        if (tmpHeaderDate != currentHeader) {
          elementsToUpdate[i].innerHTML = tmpHeaderDate;
        }
      }
    }
  },
  startTimeHeaderScheduler: function ut_startTimeHeaderScheduler() {
    this.updateTimeHeaders();
    if (this.updateTimer) {
      clearInterval(this.updateTimer);
    }
    this.updateTimer = setInterval(function(self) {
      self.updateTimeHeaders();
    }, 50000, this);
  },
  escapeHTML: function ut_escapeHTML(str, escapeQuotes) {
    var stringHTML = str;
    stringHTML = stringHTML.replace(/\</g, '&#60;');
    stringHTML = stringHTML.replace(/(\r\n|\n|\r)/gm, '<br/>');
    stringHTML = stringHTML.replace(/\s\s/g, ' &nbsp;');

    if (escapeQuotes)
      return stringHTML.replace(/"/g, '&quot;').replace(/'/g, '&#x27;');
    return stringHTML;
  },

  getFormattedHour: function ut_getFormattedHour(time) {
    switch (time.constructor) {
      case String:
        time = parseInt(time);
        break;
      case Date:
        time = time.getTime();
        break;
    }

    return dtf.localeFormat(new Date(time), _('shortTimeFormat'));
  },
  getDayDate: function re_getDayDate(timestamp) {
    var date = new Date(timestamp);
    var startDate = new Date(date.getFullYear(),
                             date.getMonth(), date.getDate());
    return startDate.getTime();
  },
  getHeaderDate: function ut_giveHeaderDate(time) {
    switch (time.constructor) {
      case String:
        time = new Number(time);
        break;
      case Date:
        time = time.getTime();
        break;
    }
    var today = Utils.getDayDate((new Date()).getTime());
    var otherDay = Utils.getDayDate(time);
    var dayDiff = (today - otherDay) / 86400000;

    if (isNaN(dayDiff))
      return _('incorrectDate');

    if (dayDiff < 0) {
      // future time
      return dtf.localeFormat(new Date(time), _('shortDateTimeFormat'));
    }

    return dayDiff == 0 && _('today') ||
      dayDiff == 1 && _('yesterday') ||
      dayDiff < 4 && dtf.localeFormat(new Date(time), '%A') ||
      dtf.localeFormat(new Date(time), '%x');
  },
  getFontSize: function ut_getFontSize() {
    if (!this.rootFontSize) {
      var htmlCss = window.getComputedStyle(document.documentElement, null);
      this.rootFontSize = parseInt(htmlCss.getPropertyValue('font-size'));
    }
    return this.rootFontSize;
  },

  getPhoneDetails: function ut_getPhoneDetails(number, contact, callback) {
    var details = {};
    var carrierToShow;

    if (contact) { // we have a contact
      var name = contact.name[0],
          length = contact.tel ? contact.tel.length : 0,
          phone = length && contact.tel[0].value ? contact.tel[0] : {
            value: '',
            type: '',
            carrier: ''
          };
          carrierToShow = phone.carrier;

      // Check which of the contacts phone number are we using
      for (var i = 0; i < contact.tel.length; i++) {
        // Based on E.164 (http://en.wikipedia.org/wiki/E.164)
        var tempPhoneNumber = contact.tel[i].value;
        if (number.length > 7) {
          var rootPhoneNumber = number.substr(-8);
        } else {
          var rootPhoneNumber = number;
        }
        if (tempPhoneNumber.indexOf(rootPhoneNumber) != -1) {
          phone = contact.tel[i];
          carrierToShow = phone.carrier;
          break;
        }
      }

      // Add data values for contact activity interaction
      details.isContact = true;

      // Add photo
      if (contact.photo && contact.photo[0]) {
        details.photoURL = URL.createObjectURL(contact.photo[0]);
      }

      // Carrier logic
      if (name && name != '') { // contact with name
        // Check if other phones with same type and carrier
        for (var i = 0; i < contact.tel.length; i++) {
          if (contact.tel[i].value !== phone.value &&
              contact.tel[i].type == phone.type &&
              contact.tel[i].carrier == phone.carrier) {
            carrierToShow = phone.value;
          }
        }
        details.title = name;
        details.carrier = (carrierToShow || phone.value);
      } else { // no name of contact
        details.title = number;
        details.carrier = (phone.carrier || '');
      }

      if (phone.type) {
        details.carrier = phone.type + ' | ' + details.carrier;
      }

    } else { // we don't have a contact
      details.title = number;
    }
    callback(details);
  }
};</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
